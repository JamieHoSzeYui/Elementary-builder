name: Building GSI..

on: [push]

env:
  TZ: Asia/Kolkata
  
jobs:
  build:
    runs-on: ubuntu-18.04

    steps:
       - name: Checkout
         uses: actions/checkout@master
       
       - name: Clean Up
         run: |
           sudo rm -rf /usr/share/dotnet /etc/mysql /etc/php /etc/apt/sources.list.d
           sudo -E apt-get -y purge azure-cli ghc* zulu* hhvm llvm* firefox google* dotnet* powershell openjdk* mysql* php*
           sudo -E apt-get update
           sudo -E apt-get -y autoremove --purge
           sudo -E apt-get clean 
           
       - name: Initializing environment
         run: |
            sudo -E apt-get -qq update
            sudo -E apt-get -qq install git openjdk-8-jdk wget expect p7zip-full p7zip-rar
       
       - name: Clone my fork of Elementary Build system
         run: https://github.com/JamieHoSzeYui/os
       
       - name: Setting up ErfanGSI requirements
         run: |
              cd os
              docker run --privileged -i -v /proc:/proc \
              -v ${PWD}:/working_dir \
              -w /working_dir \
              debian:latest \
              /bin/bash -s etc/terraform-daily-6.0-azure.conf < build.sh

       
       - name: ls
         run: |
              cd os/working_dir/
              ls
              
       - uses: actions/upload-artifact@v2
         with:
          name: Built ElementaryOS Image
          path: os/working_dir/*.iso
